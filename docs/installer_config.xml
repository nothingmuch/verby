<installer>
    <config>
		<project_root>/tmp/var/www/foo</project_root>
		<company_name>Employee Engagement Reporting System</company_name>
		<perl_module_namespace>Acme::Moose</perl_module_namespace>
		<project_url>/premier</project_url>
		<database>
    		<dsn>dbi:mysql:test</dsn>
    		<username />
    		<password />
		</database>    		
		<svn_root>svn://69.3.245.230/var/svn/infinity-work</svn_root>
		<data_dir>EERS_demo/data_files</data_dir> <!-- implies File::Spec->catdir(cwd(), "EERS_demo/data_files") -->
		<template_dir>EERS_demo/templates</template_dir>
    </config>
    
    
<!--

- Steps that have substeps must be named
- Steps which do not have substeps do not require names
- Steps with "type" can have extra (arbitrary) attributes which will be validated by the "type"

-->    
    
    <steps>
        <step name='data'>
            <!-- this implies: substeps => [] -->
    		<step name='demographics'>
    				<!-- 
    				    includes proper name, i don't know where to put it though
    				    do they get written to a config file? or to a table?
    				-->
    				<step type="load" proper_name='Age' file='lkup_age.csv' />
    				<step type="load" proper_name='Ethnicity', file='lkup_ethnic_group.csv' />
    				<step type="load" proper_name='FTE Status', file='lkup_fte_status.csv' />
    				<step type="load" proper_name='Gender', file='lkup_gender.csv' />
    				<step type="load" proper_name='Job Family', file='lkup_job_family.txt' />
    				<step type="load" proper_name='Manager Level', file='lkup_manager_level.csv' />
    				<step type="load" proper_name='Organization', file='organizations.tree' table_name='lkup_org' /> # could make lkup_org.tree
    		</step>
    		</step name='tables'>
    				<!-- data files without proper name are just loaded as is -->
    				<step type="load" file="tbl_hewitt_norms.csv" />
    				<step type="load" file="tbl_questions.txt" />
    				<step type="load" file_glob='tbl_survey_results_*.csv' />
    				<step type="load" file_glob='lkup_*_engagement_scores' />
            </step>
    	</step>

    	<step name="project_layout" type="dir" path="/tmp/var/www">
    		<step type="dir"  name_varname="project_root">
    			<step type="dir" name="htdocs">
    				<step type="svn_co" name="static" repo="..." />
    				<step type="svn_co" name="images" repo="..." />
    				<step type="svn_co" name="javascript" repo="..." />
    				<step type="svn_co" name="css" repo="..." />
    				<step type="dir" name="pdfs" />
    				<step type="dir" name="documents" />
    			</step>,

    			{ type => "dir", name => "t", substeps => [
    				# here client name is interpolated by the XML parser, i think
    				# the interpretation of the config shouldn't have to do with the syntax it's written in
    				#{ type => "template", template => "001_template_foo.t", output => "001_client_foo.t" },
    				#{ type => "template", template => "002_template_bar.t", output => "001_client_bar.t" },
    				#{ type => "template", template => "002_template_gorch.t", output => "001_client_gorch.t" },
    			]},

    			{ type => "dir", name => "database", substeps => [
    				{ type => "copy", name => "data", source_varname => "data_dir" },
    			]},

    			{ type => "dir", name => "csvdocs" }, # what's this

    			{ type => "dir", name => "conf", substeps => [
    				{ type => "template", template => "httpd.conf" }, # implicit 'out' param in pwd, httpd.conf searched in template root, relative to $0 perhaps
    				{ type => "template", template => "startup.pl", depends => "demographics" }, # depends looks up the steps created in any key by that name
    				{ type => "template", template => "startup.xml" },
    			]},

    			{ type => "dir", name => "perl", substeps => [
    				{ type => "perl_module", template => "main.pm", package_varname => "perl_module_namespace" },
    			]},
    		</step>

    		{ type => "svn_co", name => "EERS", repo => "EERS/trunk" },
    		{ type => "svn_co", name => "perl", repo => "ii-framework/trunk/lib" },
    	</step>

    	<step type="test_run" depends="project_layout" />
    </steps>  
</installer>